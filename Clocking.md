# Introduction #

Some of the components in the design run at different clock domains.
In order to generate different clock speeds, a Digital Clock Manager is used, along with two of four PLL's available in Spartan-6.

Since clock domains for different cores are not related, clock synchronization is required to prevent possible setup or hold violations or metastability issues.

Timing constraints and cross clock synchronization will be discussed in a different document; here aim is to give an insight about clock domains.

# Details #

Core Generator is used to create a DCM,with internal clock(100 MHz) as input,and with three outputs for camera interface, camera device and FIFO buffer. For finite state-machine and memory controller block, a PLL is used. Lastly, I2C master module uses internal clock stretching for a 100 KHz frequency, so same clock with camera interface is simply connected to I2C module.

## Digital Clock Manager ##


https://obstacle-detection-project.googlecode.com/git-history/master/DCM.JPG

```
-- "Output    Output      Phase     Duty      Pk-to-Pk        Phase"
-- "Clock    Freq (MHz) (degrees) Cycle (%) Jitter (ps)  Error (ps)"
------------------------------------------------------------------------------
-- CLK_OUT1____12.000______0.000______50.0______314.095____381.200
-- CLK_OUT2____96.000______0.000______50.0______216.317____381.200
-- CLK_OUT3____20.000______0.000______50.0______287.656____381.200
-- CLK_OUT4___320.000______0.000______50.0______182.674____381.200
--
------------------------------------------------------------------------------
-- "Input Clock   Freq (MHz)    Input Jitter (UI)"
------------------------------------------------------------------------------
-- __primary_________100.000____________0.010
```

|_**Core or Device**_|_**Source**_|_**Pin**_|_**Freq.**_|_**Place**_|
|:-------------------|:-----------|:--------|:----------|:----------|
|camera\_interface   |CLK\_OUT2   |clk      |96 MHz     |Internal   |
|OV7725 Cam. Module  |CLK\_OUT1   |XLCK     |12 MHz     |External   |
|OV442 FIFO Buffer   |CLK\_OUT3   |RCK      |20 MHz     |External   |
|clock\_generator    |primary     |CLK\_IN1 |100 MHz    |External   |
|memory\_controller  |CLK\_OUT4   |c3\_sys\_clk|320 MHz    |Internal   |
|control\_logic      |c3\_clk0(memory\_controller)|clk      |160 MHz    |Internal   |
|i2c\_master         |CLK\_OUT2   |clk      |96 MHz     |Internal   |

## Memory Controller Block PLL ##

https://obstacle-detection-project.googlecode.com/git-history/master/MCB%20PLL.JPG

PLL generated by MCB  provides user clock(c3\_clk0) to drive User Interface Ports (command,write and read clocks) and this clock is used in FSM as well to synchronize the controller part of the system with datapath.


Clock source of MCB core is CLK\_OUT3 of DCM which provides DDR2 memory's physical interface and memory controller clock frequencies at 320 MHz.
User interface ports however,such as described above,runs at a different frequency, generaterd by PLL inside MCB.

Output of PLL can be calculated as follows;

_fC3\_CLK\_0 = fCLK x (C\_CLKFBOUT\_MULT/C3\_DIVCLK\_DIVIDE)/C\_CLKOUT2\_DIVIDE_

Above mentioned parameters could be found in HDL instantiation of MCB.

```
    C_CLKOUT0_DIVIDE   : integer := 1;
    C_CLKOUT1_DIVIDE   : integer := 1;
    C_CLKOUT2_DIVIDE   : integer := 4;
    C_CLKOUT3_DIVIDE   : integer := 8;
    C_CLKFBOUT_MULT   : integer := 2;
    C_DIVCLK_DIVIDE   : integer := 1 
```

So, output of the PLL will be 160 MHz, which is the input clock frequency of memory's user interface ports and finite state-machine's input clock.

Worthwhile to say, CLKOUT2 of the PLL\_ADV module in design is the user clock,mentioned as _c3-clk0_

## Important Note ##

Due to multiple clock domains, cascaded input clock buffers are possible, since both DCM and MCB generates IBUFG automatically.Detailed information about the question on Xilinx MIG forums can be found in this [link](http://forums.xilinx.com/t5/MIG-Memory-Interface-Generator/NgdBuild-455-Multiple-drivers-error-related-with-DDR2-clocking/td-p/484152).

To overcome this issue; IBUFG generated by MCB core is removed manually.Since DCM provides a buffered clock as output, it is necessary to remove the one that MCB generates.